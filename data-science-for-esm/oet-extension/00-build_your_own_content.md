# Educators Build Your Own Content

This guide helps you in building your own **Data Science for Energy System Modelling** course based on a tailor-made [Jupyter Book][JupyterBook_1]. By following these instructions, you are able to:

* Duplicate the content of this course and use it as your learning material, i.e. lectures, or similar.
* Set up and deploy a static website like this course using [Github Pages action][gh_actions_python]
* Modify this course based on the Jupyter Book [structure][JupyterBook_2].


<!-- If you want to see what others have created, you can visit -->

Before starting, please make sure that you are using the correct python environment that have at least all the python package dependencies from `environment.yaml` or `requirements.txt`. The instruction are [here if you are using conda (reccomended)](../intro.md#-with-conda-recommended') and [here if you are using pip](../intro.md#-with-pip').

To follow this tutorial, basic usage of [Git][Git_1] is a prerequisit. Here are some resources and tutorials to help you get started with Git:

* [Atlassian: Getting Git right](https://www.atlassian.com/git)
* [PyPSA: Git](https://pypsa-earth.readthedocs.io/en/latest/software_hints.html#git)
* [Corey Schafer: Git Tutorial for Beginners: Command-Line Fundamentals](https://www.youtube.com/watch?v=HVsySz-h9r4)
* [Nick White: Git Tutorial For Dummies](https://www.youtube.com/watch?v=mJ-qvsxPHpY)
* [Colt Steele: Learn Git in 15 Minutes](https://www.youtube.com/watch?v=USjZcfj8yxE).

## 1. Create a New Fork

Create your fork of this repository by clicking on the figure below.

In the **Create a new fork** pop-up menu, shown in the figure below, *<ins>deselect</ins>* the default **Copy the `main` branch only** option.

By doing so, you will reduce further branch creation, required by the workflow.

:::{admonition} Fork this repository!
:class: tip

<center>
<figure>
    <a href='https://github.com/fneum/data-science-for-esm/fork'>
    <img src='https://github.com/open-energy-transition/data-science-for-esm/raw/stanford/data-science-for-esm/_images/03_fork_option.png' alt='' width='95%' style='vertical-align:middle;border:5px solid goldenrod;margin:20px 0px' />
    </a>
    <figcaption>Clicking on the image above will lead directly to the **Create a new fork**</figcaption>
</figure>
</center>
:::

> **Note:** The key point is to have at least one branch, beside the `gh-pages`, in your fork. This has been tested using both the `main`, as well as the `side branches`.

In this workflow:
* the published website static site content (`jupyter-book build` output) is in the `gh-pages` branch,
* the source code (i.e. Jupyter Book input) is in an arbitrary `branch` defined by the user: any other than `gh-pages`,

The arbitrary `branch` can be created locally:
~~~
git switch -c content_branch
git push origin content_branch
~~~

* `gh-pages` branch will be automatically generated, as defined by the `deploy.yml` workflow, hence its creation is not required.
* It is **not** required to have the `gh-pages` locally, once generated by the workflow, as it hosts only the static site build files, which are taken care of by the workflow.

> **Note:** The remote `gh-pages`, itself, hosts the required `.html`, `.css`, `.js`, and the other files, used for generating the `https://github.com/<your-username>/data-science-for-esm` website. <br /> <u>There is no requirement of having this branch locally.</u>

These will be re-generated, upon a successful workflow execution, every time `git push` is performed, in the prior specified git branch. Branch specification is provided in [Deploy Settings](./00-build_your_own_content.md#3-deploy-settings).

## 2. GitHub Pages Setting

In your fork of this repository, there is a single GitHub Setting that needs modifying:

* In the GitHub repository `https://github.com/<your-username>/data-science-for-esm`, go to the GitHub **Settings** -> **Pages** heading.

* In the **GitHub Pages** heading, go to the **Branch** section, and change the selection from `None` to `gh-pages` `/root`.

Once the branch has been selected, at the top of the page a URL will be provided:
* **Your site is live at [`https://<your-username>.github.io/data-science-for-esm`](https://fneum.github.io/data-science-for-esm/intro.html)**.

<center>
<figure>
    <a href='https://github.com/open-energy-transition/data-science-for-esm/settings/pages'>
    <img src='https://raw.githubusercontent.com/open-energy-transition/data-science-for-esm/stanford/data-science-for-esm/_images/04_gh_pages-options.png' width='97%'style='vertical-align:middle;border:5px solid darkgreen;margin:30px 30px' />
    </a>
    <figcaption>Clicking on this figure will lead directly to the our **GitHub Pages** settings menu</figcaption>
</figure>
</center>

<u>Clone the forked `data-science-for-esm` repository:</u>
```
git clone https://github.com/<your-username>/data-science-for-esm.git
cd ./data-science-for-esm
```

<!-- This GitHub is the go to location for disseminating any material, be it Jupyter Notebooks, slides, videos, markdown text explanations, or links to your other resources.  -->

## 3. Deploy Settings

<!--> **Note:** The key point is to set the correct deployment branch in the <code>./github/workflows/deploy.yml</code>. -->

In the <code>.github/workflows/deploy.yml</code> [file][deploy_1], of the cloned repository, specify the branch, to be used by the workflow:

~~~
on:
  # Trigger the workflow on push to the main branch
  push:
    branches:
    - main
~~~
Upon the `git push` command to the specified branch, which in this example is the `main` branch, the workflow will be triggered.

> **Note:** This can be any `branch` other than the <ins>`gh-pages`</ins>.

In the same [`deploy.yml` file][deploy_2] set the following permissions:

~~~
permissions:
  pages: write
  deployments: write
  contents: write
  statuses: write
  actions: write
  checks: read
~~~

This setup uses the `main` branch in the workflow, but it can also be any other newly created side-branch. Upon the `git push`, the [workflow](./00-build_your_own_content#github-workflow-deployment) will be triggered.

The deployment itself is the `jupyter-build book data-science-for-esm` [command][command]. This command is in charge generating the HTML code from the data provided in the data-science-for-esm [folder][folder].

Further explanation of this command, i.e. the `jupyter-book build`, as well as the other commands is provided in the [README.md](https://github.com/open-energy-transition/data-science-for-esm/blob/main/README.md) file. A more detailed explanation is to be found in the following Jupyter Book references:
* [Build from the command line](https://jupyterbook.org/en/stable/basics/build.html)
* [Structure the Table of Contents](https://jupyterbook.org/en/stable/structure/toc.html)

### 3a. Content (i.e. feature) Branch

This subsection is intended for users, who would like to:
* deploy their website from a so-called `feature` branch,
* keep the `main` branch in sync with the original source, i.e. the upstream.

Although it is perfectly fine to trigger the workflow from the `main` working branch, there are a couple of reasons why you should stay off the `main` branch and use a `feature` branch instead.

The argument for doing so is to keep the `main` branch of your fork `https://github.com/<your-username>/data-science-for-esm` synchronized/identical to the `main` branch of the upstream `https://github.com/fneum/data-science-for-esm` repository.

In particular, this approach facilitates comparing the fork and the upstream, retrieving updates/patches, and also allows you <ins>resetting</ins> your fork, in case something has gone completely wrong.

A simple workflow of keeping your fork's `main` up-to-date with the upstream `main` is:
~~~
git remote add upstream https://github.com/fneum/data-science-for-esm
git switch main # move to the main branch of your fork
git pull upstream main
~~~
To merge the `main` branch updates, obtained by synchronizing your `main` with the upstream `main`, into your Jupyter Book `content_branch`:

~~~
git switch content_branch # alternatively you can also do: git checkout content_branch
git cherry-pick <last main branch commit hash>
~~~

* At this point, if there are conflicts, resolve them manually, while keeping in mind that “incoming” refers to the changes obtained from the upstream using `git pull` and “HEAD” refers current state of the `content_branch`:
```
git cherry-pick --continue
```

In order to save these changes, follow the next step.

## 4. Content Modification Setup

Please use the provided files as templates, as this will assist you in content creating, reducing the time in searching for the answers.

> **Note:** `jupyter-book build` builds content from the *markdown* and jupyter notebook files, hence their content needs modifying.

* The website logo, as well as the other figures can be placed in the `data-science-for-esm/_images/` folder.
* Please keep in mind that, when changing images and modifying files, the referencing throughout `.md` and `.ipynb` files needs changing as well.
* The `.ipynb` and `.md` content files are to be located in the root of the `data-science-for--esm` folder, and specified in the `_toc.yml`.
    * If not being placed in the root, the workflow will be unable to find the files specified in the `_toc.yml`, resulting in the unsuccessful deployment, and unaccessible `github.io`.
* Please modify `*.ipynb` and `.md` files as seen fit. They are the core-content.
* Upon each content update, there is a chain of git to-do commands, resulting in the website update:
~~~
git status
git add .
git commit -m 'new changes applied'
git push origin stanford
~~~

Both `_config.yml`, as well as the `_toc.yml` are to remain in the root of the `data-science-for esm` folder. The details of the website, such as the author, logo, other relevant GitHub and Google Collab links, are defined in the `_config.yml`. Please use the already provided `_toc` and `_config.yml` files as a template, and follow their structure.

* In the `data-science-for-esm/_toc.yml` [file](https://github.com/open-energy-transition/data-science-for-esm/blob/main/data-science-for-esm/_toc.yml), a sequence of files to be included in the GitHub Page is defined, and further used by the `jupyter-build book` command.

After a successful run, the TOC displayed in the menu, located on the left side of the page.

### 4a. Add your own logo

If you want your institution to be placed in the top left corner of this website, we recommend that you follow these steps:
* name your institue logo in as `logo_int.png` and place it inside the data-science-for-esm folder.
* Run `oet-extension/merge_logo.py` to combine your institute with as smaller image of TU Berlin's and OET's logo
* Within `_config.yml`, make sure that the logo is directed to `logo: logo_merged.png`.

## 5. GitHub Workflow Deployment

In [Deploy Settings](./00-build_your_own_content.md#3-deploy-settings) we defined the deployment branch in the `.github/workflows/deploy.yml` [file][deploy], which is used by the workflow, whenever performing `git push`.

You are free to use any branch, other than the `gh-pages`, keeping in mind that only upon the `git push`, the workflow will be triggered.

The workflow deployment itself is tracked by your repository's status indicator, in this case a beige-brown dot &nbsp;<strong><b><font color='peru'>⏺</font></strong></b>
* _Clicking on it will show the running status, and the deployment details_.

As mentioned, the deployment takes minutes to finish, depending on the content files, i.e. the python commands in the Jupyter Notebooks. These will take up the most of the required deployment time.

<center>
<figure>
    <!-- <a href='https://github.com/open-energy-transition/data-science-for-esm/settings/pages'> -->
    <img src='https://raw.githubusercontent.com/mdzzg/data-science-for-esm/mdzzg/data-science-for-esm/_images/05_deployment_status.png' width='85%'style='vertical-align:middle;border:5px solid paleturquoise;margin:30px 30px' />
    <!-- </a> -->
    <figcaption>Deployment status upon <code>git push</code> to the branch specified in the **deploy.yml** file</figcaption>
</figure>
</center>

Upon the deployment finalization, the status indicator turns to:
* _successful_: a green thick <strong><b><font color='green'>🗸</font></strong></b>
    * you should be able to see the changes taking place, after some moments, at the specified `https://<your-username>.github.io/data-science-for-esm`<b>[^1]</b>
* _unsuccessful_: a red cross mark <font color="red">🗶</font>
    * indicating an error in the `_toc.yml`, or one of the content files, which need to be revisited.

<center>
<figure>
    <!-- <a href='https://github.com/open-energy-transition/data-science-for-esm/settings/pages'> -->
    <img src='https://raw.githubusercontent.com/open-energy-transition/data-science-for-esm/stanford/data-science-for-esm/_images/06_successful_deployment.png' width='85%'style='vertical-align:middle;border:5px solid paleturquoise;margin:30px 30px' />
    <!-- </a> -->
    <figcaption>Successful deployment, after a finalized <code>jupyter-book build</code> run</figcaption>
</figure>
</center>



<!-- Congratulations on creating your own Data Science for Energy System Modeling course! Here are some examples of similar courses others have developed.

If you’d like to add your course to this list, please reach out to XXX. -->


[^1]: https://github.com/executablebooks/cookiecutter-jupyter-book/tree/main

<!-- # Internal Doc References -->
[JupyterBook_1]:        https://jupyterbook.org/en/stable/start/create.html
[JupyterBook_2]:        https://jupyterbook.org/en/stable/basics/organize.html
[gh_actions_python]:    https://github.com/peaceiris/actions-gh-pages?tab=readme-ov-file#%EF%B8%8F-static-site-generators-with-python
[fneum]:    https://github.com/fneum/data-science-for-esm
[OET]:      https://open-energy-transition.github.io/handbook/docs/Engineering/SoftForkStrategy/#contributing-oet-changes-to-upstream-via-cherry-picking
[deploy]:   https://github.com/open-energy-transition/data-science-for-esm/blob/ef394898e3100e2bd2d074a8b2da89235355cd4e/.github/workflows/deploy.yml#L4-L7
[deploy_1]: https://github.com/open-energy-transition/data-science-for-esm/blob/ef394898e3100e2bd2d074a8b2da89235355cd4e/.github/workflows/deploy.yml#L4-L7
[deploy_2]: https://github.com/open-energy-transition/data-science-for-esm/blob/ef394898e3100e2bd2d074a8b2da89235355cd4e/.github/workflows/deploy.yml#L9C1-L15C15
[command]:  https://github.com/open-energy-transition/data-science-for-esm/blob/b1ab15c6d99fb325ca3877b0d33578a42669c3b7/.github/workflows/deploy.yml#L37
[folder]:   https://github.com/fneum/data-science-for-esm/tree/bc6e35f5c007a33972d23d1df7e26c59f2a875dd/data-science-for-esm

